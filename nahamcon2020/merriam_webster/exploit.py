import socket


dictionary_file = open('/usr/share/dict/words')
dic = set(x.lower().strip() for x in dictionary_file)

HOST = 'jh2i.com'
PORT = 50012

def recvuntil(sock, delim = b'\n'):
    data = b''
    while not data.endswith(delim):
        data += sock.recv(1)
    return data


def sendline(sock, data):
    sock.send(data + b'\n')
    return 1


def printline(sock, delim = b'\n'):
    res = recvuntil(sock, delim)
    print(res)
    return res


def spellcheck(wordlist):
    misspelled = spell.unknown(wordlist)
    return misspelled


def checkspell(wordlist, correct=False):
    checkedlist = []
    for word in wordlist:
        if correct == True:
            if word.decode() in dic:
                checkedlist.append(word)
        else:
            if not word.decode() in dic:
                checkedlist.append(word)
    return checkedlist


def comparedict(sock, wordlist, questiontype, correct=False):
    if correct == True:
        words = checkspell(wordlist, correct=True)
    else:
        words = checkspell(wordlist)
    if questiontype == 'number':
        number = len(words)
        sendline(sock, str(number).encode())
    elif questiontype == 'chronological':
        answerlist = b' '.join(words)
        sendline(sock, answerlist)
    elif questiontype == 'alphabetical':
        answerlist = sorted(words)
        answerlist =b' '.join(answerlist)
        sendline(sock, answerlist)
    return 1


conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
conn.connect((HOST, PORT))

count = 0

while count <= 600:
    count += 1
    prompt = printline(conn)
    res = printline(conn)
    res = res.strip()
    wordlist = res.split()
    
    if b'how many' in prompt:
        if b'NOT' in prompt:
            comparedict(conn, wordlist, 'number')
        else:
            comparedict(conn, wordlist, 'number', correct=True)

    if b'CHRONOLOGICAL ORDER' in prompt:
        if b'NOT' in prompt:
            comparedict(conn, wordlist, 'chronological')
        else:
            comparedict(conn, wordlist, 'chronological', correct=True)

    if b'ALPHABETICAL ORDER' in prompt:
        if b'NOT' in prompt:
            comparedict(conn, wordlist, 'alphabetical')
        else:
            comparedict(conn, wordlist, 'alphabetical', correct=True)
    message = printline(conn)

    if b'WRONG' in message:
        print('+++++++++++++++++++++++++++++++++++++++++++++++++++++++')
        print('Something wrong happened')
        conn.close()
        conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        conn.connect((HOST, PORT))
        count = 0
    
conn.close()
